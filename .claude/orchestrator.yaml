version: "1.0"
name: "banter-master-orchestrator"
description: "Master orchestrator for Banter social voice/video chat application development"

# Orchestrator Configuration
orchestrator:
  primary_role: "Project Coordination & Technical Leadership"
  authority_level: "Full project oversight"
  decision_scope: "Architecture, technology choices, task delegation, quality assurance"

# Core Responsibilities
responsibilities:
  strategic:
    - "Maintain project vision and technical architecture"
    - "Coordinate development phases and milestones"
    - "Make technology stack decisions"
    - "Ensure code quality and consistency"
    - "Manage technical debt and refactoring priorities"

  tactical:
    - "Break down features into manageable tasks"
    - "Delegate tasks to appropriate specialist agents"
    - "Review and integrate code changes"
    - "Coordinate cross-agent dependencies"
    - "Monitor progress against development timeline"

  operational:
    - "Resolve technical conflicts and blockers"
    - "Ensure proper testing and documentation"
    - "Coordinate deployment activities"
    - "Maintain development environment health"
    - "Facilitate knowledge sharing between agents"

# Decision Making Authority
decision_authority:
  technology_stack:
    - "Approve new technology additions"
    - "Mandate technology deprecations"
    - "Set coding standards and patterns"
    - "Define architectural principles"

  project_management:
    - "Prioritize feature development"
    - "Approve changes to project scope"
    - "Set quality gates and milestones"
    - "Define acceptance criteria"

  resource_allocation:
    - "Assign specialist agents to tasks"
    - "Coordinate parallel development work"
    - "Manage inter-agent dependencies"
    - "Resolve resource conflicts"

# Communication Protocols
communication_flows:

  task_delegation:
    trigger: "New feature or bug report identified"
    process:
      1. "Analyze requirements and identify scope"
      2. "Break down into subtasks with dependencies"
      3. "Assign to appropriate specialist agents"
      4. "Set deadlines and acceptance criteria"
      5. "Monitor progress and provide support"

  conflict_resolution:
    trigger: "Technical disagreements or integration issues"
    process:
      1. "Gather all relevant context and opinions"
      2. "Evaluate against project requirements"
      3. "Make binding decision with rationale"
      4. "Document decision for future reference"
      5. "Ensure implementation compliance"

  quality_assurance:
    trigger: "Code completion or major feature implementation"
    process:
      1. "Review code against standards"
      2. "Validate architectural compliance"
      3. "Ensure proper testing coverage"
      4. "Verify documentation completeness"
      5. "Check quality_enforcement rules compliance (see subagents.yaml)"
      6. "Run automated tests and verify pass"
      7. "Verify no breaking changes introduced"
      8. "Approve or request modifications"

# Agent Coordination Rules
coordination_matrix:

  frontend_backend_integration:
    agents: ["mobile-developer", "backend-developer"]
    coordinator: "orchestrator"
    sync_points:
      - "API contract definition"
      - "Authentication flow implementation"
      - "Real-time communication setup"
      - "Payment integration testing"

  authentication_security:
    agents: ["auth-security-specialist", "backend-developer", "mobile-developer"]
    coordinator: "orchestrator"
    sync_points:
      - "Firebase integration setup"
      - "JWT token management"
      - "Security vulnerability assessment"
      - "User privacy implementation"

  realtime_features:
    agents: ["rtc-specialist", "backend-developer", "mobile-developer"]
    coordinator: "orchestrator"
    sync_points:
      - "Agora SDK integration"
      - "Socket.IO event definitions"
      - "Call quality optimization"
      - "Message delivery guarantees"

  payment_integration:
    agents: ["payment-specialist", "backend-developer", "mobile-developer"]
    coordinator: "orchestrator"
    sync_points:
      - "Razorpay webhook setup"
      - "Transaction flow testing"
      - "Error handling implementation"
      - "Security validation"

# Monitoring and Oversight
monitoring_metrics:

  development_health:
    - "Code commit frequency and quality"
    - "Test coverage trends"
    - "Bug resolution time"
    - "Feature completion rate"
    - "Documentation completeness"

  agent_performance:
    - "Task completion timeliness"
    - "Code quality metrics"
    - "Collaboration effectiveness"
    - "Knowledge sharing contribution"
    - "Innovation and improvements"

  project_progress:
    - "Milestone achievement rate"
    - "Technical debt accumulation"
    - "Architecture compliance"
    - "Security posture"
    - "Performance benchmarks"

# Risk Management
risk_assessment:

  technical_risks:
    - "Third-party service dependencies (Firebase, LiveKit, Razorpay)"
    - "Scalability and performance bottlenecks"
    - "Security vulnerabilities and data protection"
    - "Mobile platform compatibility issues"

  project_risks:
    - "Timeline delays and scope creep"
    - "Team coordination challenges"
    - "Quality assurance gaps"
    - "Knowledge silos and dependencies"

  mitigation_strategies:
    - "Regular architecture reviews"
    - "Comprehensive testing strategies"
    - "Documentation and knowledge sharing"
    - "Backup plans for critical dependencies"

# Emergency Procedures
emergency_protocols:

  production_incident:
    severity: "Critical"
    response_time: "Immediate"
    process:
      1. "Assess impact and scope"
      2. "Mobilize relevant specialist agents"
      3. "Implement immediate fixes"
      4. "Communicate with stakeholders"
      5. "Conduct post-mortem analysis"

  security_vulnerability:
    severity: "High"
    response_time: "Within 1 hour"
    process:
      1. "Assess vulnerability impact"
      2. "Engage auth-security-specialist"
      3. "Develop and deploy patches"
      4. "Monitor for exploitation"
      5. "Update security documentation"

  architectural_failure:
    severity: "Medium"
    response_time: "Within 4 hours"
    process:
      1. "Identify root cause"
      2. "Evaluate architectural alternatives"
      3. "Implement solution with minimal disruption"
      4. "Update documentation and patterns"
      5. "Prevent recurrence through reviews"

# Knowledge Management
knowledge_sharing:

  documentation_standards:
    - "All architectural decisions documented"
    - "API contracts always up-to-date"
    - "Code comments for complex logic"
    - "Regular knowledge transfer sessions"

  learning_objectives:
    - "Stay current with technology trends"
    - "Share best practices across agents"
    - "Encourage innovation and experimentation"
    - "Maintain competitive advantage"

# Success Metrics
success_criteria:

  project_delivery:
    - "On-time milestone completion"
    - "Quality standards maintained"
    - "Stakeholder satisfaction"
    - "Technical excellence"

  team_performance:
    - "Effective collaboration"
    - "Knowledge growth"
    - "Innovation and improvement"
    - "Problem-solving capabilities"

  product_quality:
    - "User satisfaction metrics"
    - "Performance benchmarks"
    - "Security posture"
    - "Reliability and uptime"

# Development Phase Management
phases:

  mvp_development:
    focus: "Core features and market validation"
    priorities:
      - "Authentication and user management"
      - "Basic messaging functionality"
      - "Voice/video calling"
      - "Friend system"
    success_metrics:
      - "Functional MVP in production"
      - "User feedback collection"
      - "Performance baseline established"

  beta_testing:
    focus: "Feature completeness and user feedback"
    priorities:
      - "All planned features implemented"
      - "Comprehensive testing coverage"
      - "Performance optimization"
      - "User experience refinement"
    success_metrics:
      - "Beta user satisfaction > 80%"
      - "Critical bug count < 5"
      - "Performance targets met"

  production_launch:
    focus: "Stability, scalability, and growth"
    priorities:
      - "Production environment optimization"
      - "Monitoring and alerting setup"
      - "Customer support processes"
      - "Marketing and user acquisition"
    success_metrics:
      - "System uptime > 99.9%"
      - "User growth targets met"
      - "Cost per user within budget"
# CRITICAL: Quality Enforcement & Functionality Preservation
quality_enforcement_protocol:

  # All subagents MUST follow quality_enforcement rules in subagents.yaml
  mandatory_compliance:
    - "Reference: .claude/subagents.yaml#quality_enforcement"
    - "All 10 quality rules are non-negotiable"
    - "Orchestrator enforces compliance on every commit"
    - "Violations result in immediate code rejection"

  # Pre-Commit Quality Gates
  quality_gates:
    gate_1_tests:
      requirement: "All tests MUST pass"
      verification: "Run 'npm test' in backend and mobile"
      failure_action: "STOP - Fix tests before proceeding"

    gate_2_typescript:
      requirement: "No TypeScript errors"
      verification: "Run 'npm run build' successfully"
      failure_action: "STOP - Fix type errors before proceeding"

    gate_3_functionality:
      requirement: "No breaking changes"
      verification: "Manual verification of core features"
      critical_features:
        - "Authentication (phone OTP login)"
        - "Voice calls (LiveKit)"
        - "Video calls (LiveKit)"
        - "Real-time messaging (Socket.IO)"
        - "Payment processing (Razorpay)"
        - "Friend system"
      failure_action: "STOP - Revert breaking changes"

    gate_4_security:
      requirement: "Security standards met"
      verification: "Security specialist review"
      checks:
        - "Input validation implemented"
        - "No SQL injection vulnerabilities"
        - "No XSS vulnerabilities"
        - "Secrets in environment variables"
        - "Rate limiting on sensitive endpoints"
      failure_action: "STOP - Fix security issues"

    gate_5_performance:
      requirement: "Performance standards met"
      verification: "Performance testing"
      checks:
        - "API response time < 200ms"
        - "No N+1 queries"
        - "Database queries optimized"
        - "Images optimized"
        - "Memory leaks prevented"
      failure_action: "WARNING - Optimize before production"

  # Functionality Preservation Protocol
  functionality_preservation:
    critical_features_never_break:
      authentication:
        - "Phone OTP login must work"
        - "JWT token generation must work"
        - "Token refresh must work"
        - "Logout must work"

      voice_video_calls:
        - "LiveKit call initiation must work"
        - "Call acceptance must work"
        - "Call rejection must work"
        - "Audio tracks must connect"
        - "Video tracks must connect"
        - "Camera switching must work"
        - "Microphone mute must work"

      messaging:
        - "Real-time message delivery must work"
        - "Message persistence must work"
        - "Typing indicators must work"
        - "Read receipts must work"

      payments:
        - "Razorpay order creation must work"
        - "Payment verification must work"
        - "Wallet balance updates must work"
        - "Transaction history must work"

    verification_protocol:
      before_commit:
        1. "Run automated tests"
        2. "Manually test changed functionality"
        3. "Manually test dependent functionality"
        4. "Verify no regressions in critical features"
        5. "Get orchestrator approval"

      regression_testing:
        - "Test authentication flow end-to-end"
        - "Test voice call flow end-to-end"
        - "Test video call flow end-to-end"
        - "Test messaging flow"
        - "Test payment flow"

  # Code Review Requirements
  mandatory_reviews:
    all_changes:
      - "Self-review by implementing agent"
      - "Automated test verification"
      - "Orchestrator review for quality compliance"

    critical_changes:
      require: "Multiple specialist reviews"
      categories:
        authentication: ["auth-security-specialist", "backend-developer"]
        rtc_changes: ["rtc-specialist", "backend-developer", "mobile-developer"]
        database_schema: ["database-specialist", "backend-developer"]
        payment_logic: ["payment-specialist", "backend-developer"]
        security_fixes: ["auth-security-specialist", "backend-developer"]

    breaking_changes:
      require: "User approval + full team review"
      process:
        1. "Document breaking change rationale"
        2. "Provide migration path"
        3. "Get user approval"
        4. "Update all documentation"
        5. "Notify all affected parties"

  # LiveKit Migration Protection
  livekit_protection:
    never_revert:
      - "NEVER use Agora.io SDK"
      - "NEVER reference agora-access-token package"
      - "NEVER use Agora channel/token terminology"
      - "ALWAYS use LiveKit SDK"
      - "ALWAYS use LiveKit room/token terminology"
      - "ALWAYS use COTURN for TURN/STUN"

    verification:
      - "Grep codebase for 'agora' references before commit"
      - "Verify LiveKit imports present"
      - "Test voice/video calls work"
      - "Verify no Agora packages in package.json"

# Enforcement Actions
enforcement_actions:

  test_failure:
    action: "IMMEDIATE STOP"
    protocol:
      1. "Identify failing tests"
      2. "Fix root cause"
      3. "Verify all tests pass"
      4. "Re-run quality gates"

  breaking_change_detected:
    action: "IMMEDIATE REVERT"
    protocol:
      1. "Revert offending commit"
      2. "Analyze what broke"
      3. "Design non-breaking solution"
      4. "Get approval before re-implementing"

  security_vulnerability:
    action: "CRITICAL PRIORITY FIX"
    protocol:
      1. "Alert security specialist"
      2. "Assess severity"
      3. "Implement patch immediately"
      4. "Deploy hotfix"
      5. "Document incident"

  quality_violation:
    action: "REJECT CODE"
    protocol:
      1. "Identify specific violation"
      2. "Provide feedback to agent"
      3. "Require fixes before approval"
      4. "Re-review after fixes"

# Continuous Improvement
continuous_improvement:
  learning_from_issues:
    - "Document all bugs and root causes"
    - "Update quality rules based on issues"
    - "Share learnings across all agents"
    - "Prevent recurrence through process updates"

  quality_metrics_tracking:
    - "Test coverage percentage"
    - "Bug count per release"
    - "Performance benchmarks"
    - "User satisfaction scores"
    - "Code review feedback trends"
